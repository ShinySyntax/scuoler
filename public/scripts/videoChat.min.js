let socket,videoGrid,myVideo,myVideoStream,myName,path=window.location.pathname,ROOM_ID=path.substring(path.lastIndexOf("/")+1);const peers={};let peer,screenShare=!1;const getPeer=()=>(peer||(peer=new Peer(void 0,{path:"/peerjsServer",host:"/",port:"443"})),peer),getSocket=()=>(socket||(socket=io("/")),socket),getVideoGrid=()=>(videoGrid||(videoGrid=document.getElementById("videoChat-left-video-grid"),videoGrid.insertAdjacentHTML("beforeend",'<video autoplay="true" muted="true"/>')),videoGrid),getMyVideo=()=>(myVideo||(myVideo=getVideoGrid().firstChild),myVideo),nameClicked=()=>{let e=document.getElementById("videChat__Dialog__input").value;myName=e,document.getElementById("videChat__Dialog").remove()},getMyName=e=>{document.getElementsByClassName("videoChat")[0].insertAdjacentHTML("beforeend",`<div id="videChat__Dialog" >\n    <span><strong>Enter your name:</strong></span>\n    <input id="videChat__Dialog__input" type="text" value="${e}"/>\n    <button onclick="nameClicked()">OK</button>\n    </div>`)},scrollToBottom=e=>{e.scrollTop=e.scrollHeight},addVideoStream=(e,t)=>{e.srcObject=t,e.onloadedmetadata=function(t){e.play()}},camMediaOptions={video:!0,audio:!0},getMyVideoStream=()=>new Promise((function(e,t){myVideoStream?e(myVideoStream):window.navigator.mediaDevices.getUserMedia(camMediaOptions).then((t=>{myVideoStream=t,addVideoStream(getMyVideo(),myVideoStream),e(myVideoStream)})).catch((e=>{console.log(`err in getting user media ${e}`),t(e)}))})),init=()=>{getMyVideoStream().then().catch((e=>{console.log(`err in getting user media ${e}`)}));const e=document.getElementById("chat_message");e.addEventListener("keyup",(function(t){if(t.preventDefault(),"Enter"===t.key&&e.value?.length>0){let t={name:myName,message:e.value};getSocket().emit("message",JSON.stringify(t)),e.value=""}})),getSocket().on("createMessage",(e=>{let t=JSON.parse(e);var a;liEl=document.createElement("li"),liEl.setAttribute("class","MessageElement"),liEl.innerHTML=`<b>${t.name.substring(0,11)}</b><br/>${t.message}`,ulEl=document.getElementById("chat-right-MessagesUl"),ulEl.appendChild(liEl),(a=ulEl).scrollTop=a.scrollHeight})),getPeer().on("open",(e=>{var t;getMyVideo()?.setAttribute("class",e),getSocket().emit("join-room",ROOM_ID,e),myName||(t=e,document.getElementsByClassName("videoChat")[0].insertAdjacentHTML("beforeend",`<div id="videChat__Dialog" >\n    <span><strong>Enter your name:</strong></span>\n    <input id="videChat__Dialog__input" type="text" value="${t}"/>\n    <button onclick="nameClicked()">OK</button>\n    </div>`))})),getSocket().on("user-connected",(e=>{console.log("user connected"),getMyVideoStream().then((t=>{connectToNewUser(e,t)})).catch((e=>{console.log(`err in getting user media ${e}`)}))})),getSocket().on("user-disconnected",(e=>{let t=document.getElementsByClassName(e)[0];t&&t.remove(),peers[e]&&peers[e].close()})),getPeer().on("call",(e=>{let t;peers[e.peer]=e,getMyVideoStream().then((t=>{e.answer(t)})).catch((e=>{console.log(`err in getting user media ${e}`)})),getVideoGrid().insertAdjacentHTML("beforeend",`<video class="${e.peer}" autoplay="true"  />`),e.on("stream",(e=>{t=getVideoGrid().lastChild,addVideoStream(t,e)})),e.on("close",(()=>{t.remove()}))}))};init();const connectToNewUser=(e,t)=>{const a=getPeer().call(e,t);let o;console.log("another new user",e,a),getVideoGrid().insertAdjacentHTML("beforeend",`<video class="${e}" autoplay="true"  />`),a.on("stream",(e=>{o=getVideoGrid().lastChild,addVideoStream(o,e)})),a.on("close",(()=>{o.remove()})),peers[e]=a},muteUnmute=()=>{getMyVideoStream().then((e=>{if(console.log(e.getTracks()),e.getAudioTracks().length>0){e.getAudioTracks()[0].enabled?(e.getAudioTracks()[0].enabled=!1,setUnmuteButton()):(e.getAudioTracks()[0].enabled=!0,setMuteButton())}}))},setMuteButton=()=>{document.getElementsByClassName("videoChat__left__mute__button")[0].innerHTML='<i class="fas fa-microphone"></i>\n                <span>Mute</span>'},setUnmuteButton=()=>{document.getElementsByClassName("videoChat__left__mute__button")[0].innerHTML='<i class="unmute fas fa-microphone-slash"></i>\n                <span>Unmute</span>'},stopUnstopVideo=()=>{getMyVideoStream().then((e=>{e.getVideoTracks()[0].enabled?(e.getVideoTracks()[0].enabled=!1,setPlayVideoButton()):(e.getVideoTracks()[0].enabled=!0,setStopVideoButton())}))},setStopVideoButton=()=>{document.getElementsByClassName("videoChat__left__stopVideo__button")[0].innerHTML='<i class="fa-solid fa-video"></i>\n                <span>Stop Video</span>'},setPlayVideoButton=()=>{document.getElementsByClassName("videoChat__left__stopVideo__button")[0].innerHTML='<i class="stop fa-solid fa-video-slash"></i>\n                <span>Play Video</span>'},switchToScreenShare=async()=>{if(screenShare){let e=await window.navigator.mediaDevices.getUserMedia(camMediaOptions),t=await getMyVideoStream();await replaceVideoTracks(t,e),screenShare=!1,setNoScreenShareButton()}else{let e=await window.navigator.mediaDevices.getDisplayMedia(camMediaOptions),t=await getMyVideoStream();await replaceVideoTracks(t,e),screenShare=!0,setScreenShareButton()}},setScreenShareButton=()=>{document.getElementsByClassName("videoChat__left__screenshare__button")[0].innerHTML='<i class="fas fa-desktop"></i>\n                <span>Screenshare</span>'},setNoScreenShareButton=()=>{document.getElementsByClassName("videoChat__left__screenshare__button")[0].innerHTML='<i class="noScreenShare fas fa-desktop"></i>\n                <span>Screenshare</span>'},replaceVideoTracks=async(e,t)=>{let a=[...e.getTracks()];for(let t=0;t<a.length;t++)"video"===a[t].kind&&await e.removeTrack(a[t]);for(let a=0;a<t.getTracks().length;a++)"video"===t.getTracks()[a].kind&&await e.addTrack(t.getTracks()[a])};
let socket,videoGrid,myVideo,myVideoStream,myName,path=window.location.pathname,ROOM_ID=path.substring(path.lastIndexOf("/")+1);const peers={};let peer;const getPeer=()=>(peer||(peer=new Peer(void 0,{path:"/peerjsServer",host:"/",port:"443"})),peer),getSocket=()=>(socket||(socket=io("/")),socket),getVideoGrid=()=>(videoGrid||(videoGrid=document.getElementById("videoChat-left-video-grid"),videoGrid.insertAdjacentHTML("beforeend",'<video autoplay="true" muted="true"/>')),videoGrid),getMyVideo=()=>(myVideo||(myVideo=getVideoGrid().firstChild),myVideo),nameClicked=()=>{let e=document.getElementById("videChat__Dialog__input").value;myName=e,document.getElementById("videChat__Dialog").remove()},getMyName=e=>{document.getElementsByClassName("videoChat")[0].insertAdjacentHTML("beforeend",`<div id="videChat__Dialog" >\n    <span><strong>Enter your name:</strong></span>\n    <input id="videChat__Dialog__input" type="text" value="${e}"/>\n    <button onclick="nameClicked()">OK</button>\n    </div>`)},scrollToBottom=e=>{e.scrollTop=e.scrollHeight},addVideoStream=(e,t)=>{e.srcObject=t,e.onloadedmetadata=function(t){e.play()}},camMediaOptions={video:!0,audio:!0},getMyVideoStream=()=>new Promise((function(e,t){myVideoStream?e(myVideoStream):window.navigator.mediaDevices.getUserMedia(camMediaOptions).then((t=>{myVideoStream=t,addVideoStream(getMyVideo(),myVideoStream),e(myVideoStream)})).catch((e=>{console.log(`err in getting user media ${e}`),t(e)}))})),init=()=>{getMyVideoStream().then().catch((e=>{console.log(`err in getting user media ${e}`)}));const e=document.getElementById("chat_message");e.addEventListener("keyup",(function(t){if(t.preventDefault(),"Enter"===t.key&&e.value?.length>0){let t={name:myName,message:e.value};getSocket().emit("message",JSON.stringify(t)),e.value=""}})),getSocket().on("createMessage",(e=>{let t=JSON.parse(e);var o;liEl=document.createElement("li"),liEl.setAttribute("class","MessageElement"),liEl.innerHTML=`<b>${t.name.substring(0,11)}</b><br/>${t.message}`,ulEl=document.getElementById("chat-right-MessagesUl"),ulEl.appendChild(liEl),(o=ulEl).scrollTop=o.scrollHeight})),getPeer().on("open",(e=>{var t;getMyVideo()?.setAttribute("class",e),getSocket().emit("join-room",ROOM_ID,e),myName||(t=e,document.getElementsByClassName("videoChat")[0].insertAdjacentHTML("beforeend",`<div id="videChat__Dialog" >\n    <span><strong>Enter your name:</strong></span>\n    <input id="videChat__Dialog__input" type="text" value="${t}"/>\n    <button onclick="nameClicked()">OK</button>\n    </div>`))})),getSocket().on("user-connected",(e=>{console.log("user connected"),getMyVideoStream().then((t=>{connectToNewUser(e,t)})).catch((e=>{console.log(`err in getting user media ${e}`)}))})),getSocket().on("user-disconnected",(e=>{let t=document.getElementsByClassName(e)[0];t&&t.remove(),peers[e]&&peers[e].close()})),getPeer().on("call",(e=>{let t;peers[e.peer]=e,getMyVideoStream().then((t=>{e.answer(t)})).catch((e=>{console.log(`err in getting user media ${e}`)})),getVideoGrid().insertAdjacentHTML("beforeend",`<video class="${e.peer}" autoplay="true"  />`),e.on("stream",(e=>{t=getVideoGrid().lastChild,addVideoStream(t,e)})),e.on("close",(()=>{t.remove()}))}))};init();const connectToNewUser=(e,t)=>{const o=getPeer().call(e,t);let n;console.log("another new user",e,o),getVideoGrid().insertAdjacentHTML("beforeend",`<video class="${e}" autoplay="true"  />`),o.on("stream",(e=>{n=getVideoGrid().lastChild,addVideoStream(n,e)})),o.on("close",(()=>{n.remove()})),peers[e]=o},muteUnmute=()=>{getMyVideoStream().then((e=>{e.getAudioTracks()[0].enabled?(e.getAudioTracks()[0].enabled=!1,setUnmuteButton()):(e.getAudioTracks()[0].enabled=!0,setMuteButton())}))},setMuteButton=()=>{document.getElementsByClassName("videoChat__left__mute__button")[0].innerHTML='<i class="fas fa-microphone"></i>\n                <span>Mute</span>'},setUnmuteButton=()=>{document.getElementsByClassName("videoChat__left__mute__button")[0].innerHTML='<i class="unmute fas fa-microphone-slash"></i>\n                <span>Unmute</span>'},stopUnstopVideo=()=>{getMyVideoStream().then((e=>{e.getVideoTracks()[0].enabled?(e.getVideoTracks()[0].enabled=!1,setPlayVideoButton()):(e.getVideoTracks()[0].enabled=!0,setStopVideoButton())}))},setStopVideoButton=()=>{document.getElementsByClassName("videoChat__left__stopVideo__button")[0].innerHTML='<i class="fa-solid fa-video"></i>\n                <span>Stop Video</span>'},setPlayVideoButton=()=>{document.getElementsByClassName("videoChat__left__stopVideo__button")[0].innerHTML='<i class="stop fa-solid fa-video-slash"></i>\n                <span>Play Video</span>'};